<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BasicCalc - Calculadora de Independência Financeira</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

 <header class="topo-tela">
    <div class="header-container">
        <img src="assets/img/logo.png" alt="BasicCalc Logo" class="logo">
        
        <button class="hamburger-btn" id="hamburger-btn">
            &#9776; </button>

        <nav class="main-nav" id="main-nav-links">
            <ul>
                <li><a href="index.html">Início</a></li>
                
                <li class="dropdown">
                    <a href="javascript:void(0);" class="drop-btn">Calculadoras &#9662;</a>
                    <div class="dropdown-content">
                        <div class="dropdown-column">
                            <h4>Orçamento e Carreira</h4>
                            <a href="sal_liquido.html">Salário Líquido</a>
                            <a href="503020calc.html">Divisão de Salário</a>
                            <a href="despesas.html">Divisão de Despesas</a>
                        </div>
                        <div class="dropdown-column">
                            <h4>Metas e Dívidas</h4>
                            <a href="independencia.html">Independência Financeira</a>
                            <a href="metas.html">Metas Financeiras</a>
                            <a href="dividas.html">Quitação de Dívidas</a>
                            <a href="juros.html">Juros Compostos</a>
                        </div>
                        <div class="dropdown-column">
                            <h4>Automóvel</h4>
                            <a href="gasxalc.html">Álcool ou Gasolina</a>
                            <a href="custo_viagem.html">Custo de Viagem</a>
                        </div>
                    </div>
                </li>

                <li><a href="sobre.html">Sobre</a></li>
            </ul>
            </nav>
        </div>
    </header>

    <main class="page-container">
        <div class="ads-placeholder">
            <p>Espaço para Anúncio</p>
        </div>

        <div class="calculator-container">
            <h2>Calculadora de Independência Financeira</h2>
            <p style="text-align: center; margin-top: -1.5rem; margin-bottom: 2rem; font-size: 0.9em; color: #6c757d;">Descubra em quanto tempo você pode alcançar a liberdade financeira.</p>
            
            <form id="if-form">
                
                <div class="input-group">
                    <label for="custoMensal">Qual seu custo de vida mensal? (R$)</label>
                    <input type="number" id="custoMensal" placeholder="Ex: 4000" required>
                </div>

                <div class="input-group">
                    <label for="patrimonioAtual">Quanto você já tem investido? (R$)</label>
                    <input type="number" id="patrimonioAtual" value="0" placeholder="Ex: 50000" required>
                </div>

                <div class="input-group">
                    <label for="aporteMensal">Quanto você investe por mês? (R$)</label>
                    <input type="number" id="aporteMensal" placeholder="Ex: 1500" required>
                </div>

                <div class="input-group">
                    <label for="rentabilidadeAnual">Rentabilidade real anual estimada (%)</label>
                    <input type="number" id="rentabilidadeAnual" step="0.1" value="6" placeholder="Ex: 6" required>
                </div>

                <button type="submit">Calcular Minha Jornada IF</button>
            </form>

            <div id="resultado" class="result-area" style="display: none;">
                </div>
        </div>
        
        <div class="ads-placeholder">
            <p>Espaço para Anúncio</p>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 BasicCalc. Todos os direitos reservados.</p>
    </footer>

    <script>
        // Variável global para destruir o gráfico anterior antes de criar um novo
        let projectionChart = null;

        document.getElementById('if-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // 1. CAPTURAR VALORES
            const custoMensal = parseFloat(document.getElementById('custoMensal').value);
            const patrimonioAtual = parseFloat(document.getElementById('patrimonioAtual').value);
            const aporteMensal = parseFloat(document.getElementById('aporteMensal').value);
            const rentabilidadeAnual = parseFloat(document.getElementById('rentabilidadeAnual').value);

            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.style.display = 'block';

            // 2. VALIDAÇÃO
            if (isNaN(custoMensal) || isNaN(patrimonioAtual) || isNaN(aporteMensal) || isNaN(rentabilidadeAnual) || custoMensal <= 0 || aporteMensal <= 0) {
                resultadoDiv.innerHTML = '<p style="color: red;">Por favor, preencha todos os campos com valores positivos.</p>';
                return;
            }

            // 3. CÁLCULOS INICIAIS
            const metaIF = custoMensal * 12 * 25;
            const i = Math.pow(1 + (rentabilidadeAnual / 100), 1/12) - 1; // Taxa de juros mensal real

            if (patrimonioAtual >= metaIF) {
                resultadoDiv.innerHTML = '<h3>Parabéns!</h3><p style="color: green;">Com base nos seus dados, você já atingiu a Independência Financeira!</p>';
                return;
            }
            
            // 4. CÁLCULO DO TEMPO (NPER)
            // Fórmula NPER: n = log( (FV*i + PMT) / (PV*i + PMT) ) / log(1+i)
            const fv = metaIF;
            const pv = patrimonioAtual;
            const pmt = aporteMensal;
            
            const numerador = Math.log((fv * i + pmt) / (pv * i + pmt));
            const denominador = Math.log(1 + i);
            const totalMeses = numerador / denominador;
            
            if (totalMeses <= 0 || !isFinite(totalMeses)) {
                 resultadoDiv.innerHTML = '<p style="color: red;">Com os dados informados, o objetivo não seria alcançável. Tente aumentar o aporte ou a rentabilidade.</p>';
                return;
            }

            const anos = Math.floor(totalMeses / 12);
            const meses = Math.ceil(totalMeses % 12);

            // 5. CÁLCULO DOS TOTAIS
            const totalAportado = aporteMensal * totalMeses;
            const totalJuros = metaIF - patrimonioAtual - totalAportado;

            const formatarDinheiro = (valor) => valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // 6. GERAR GRÁFICO E RESULTADO
            gerarGrafico(anos, patrimonioAtual, aporteMensal, i, metaIF);

            resultadoDiv.innerHTML = `
                <h3>Sua Jornada para a Independência Financeira</h3>
                <p>Sua meta para a IF (o "Número Mágico") é de <strong>${formatarDinheiro(metaIF)}</strong>.</p>
                <div class="resultado-principal" style="font-size: 1.3em; text-align: center; margin: 1em 0;">
                    Você atingirá seu objetivo em<br><strong>${anos} anos e ${meses} meses</strong>.
                </div>
                
                <h4>Resumo da sua jornada:</h4>
                <ul>
                    <li>Patrimônio Inicial: <span>${formatarDinheiro(patrimonioAtual)}</span></li>
                    <li>Total Investido por você: <span>${formatarDinheiro(totalAportado)}</span></li>
                    <li>Total Gerado por Juros: <span class="juros">${formatarDinheiro(totalJuros)} ✨</span></li>
                </ul>
                <hr>
                <canvas id="graficoProjecao" style="margin-top: 1rem;"></canvas>
            `;
            
            // A inicialização do gráfico precisa acontecer depois que o canvas é inserido no DOM
            renderizarGrafico();
        });

        // Objeto global para armazenar os dados do gráfico
        const dadosDoGrafico = {};

        function gerarGrafico(anos, pv, pmt, i, meta) {
            const labels = [];
            const data = [];
            let valorAtual = pv;

            for (let ano = 0; ano <= anos + 1; ano++) {
                labels.push(`Ano ${ano}`);
                data.push(valorAtual);
                // Calcula o valor para o próximo ano
                for(let mes = 0; mes < 12; mes++) {
                    valorAtual = valorAtual * (1 + i) + pmt;
                }
            }

            dadosDoGrafico.labels = labels;
            dadosDoGrafico.data = data;
            dadosDoGrafico.meta = meta;
        }

        function renderizarGrafico() {
            const ctx = document.getElementById('graficoProjecao').getContext('2d');
            
            if (projectionChart) {
                projectionChart.destroy(); // Destrói o gráfico antigo
            }

            projectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dadosDoGrafico.labels,
                    datasets: [{
                        label: 'Seu Patrimônio',
                        data: dadosDoGrafico.data,
                        backgroundColor: 'rgba(0, 123, 255, 0.2)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }, {
                        label: 'Meta de IF',
                        data: Array(dadosDoGrafico.labels.length).fill(dadosDoGrafico.meta),
                        borderColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value, index, values) {
                                    return 'R$ ' + (value / 1000) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>

</body>
</html>